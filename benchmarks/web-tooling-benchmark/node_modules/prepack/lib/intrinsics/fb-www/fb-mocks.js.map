{"version":3,"sources":["../../../src/intrinsics/fb-www/fb-mocks.js"],"names":["createFbMocks","t","fbMagicGlobalFunctions","fbMagicGlobalObjects","createBabelHelpers","realm","global","babelHelpersValue","intrinsics","ObjectPrototype","objectAssign","Object","objectCreate","inheritsValue","undefined","context","subClass","superClass","objectAssignCall","$Call","superClassPrototype","objectCreateCall","newPrototype","Set","$DefineOwnProperty","value","writable","enumerable","configurable","intrinsicName","objectWithoutPropertiesValue","obj","keys","isPartialObject","createTemporalFromBuildFunction","methodNode","objNode","propRemoveNode","callExpression","makeSimple","removeKeys","key","add","newObject","ObjectCreate","propName","binding","properties","has","descriptor","taggedTemplateLiteralLooseValue","strings","raw","functionBind","FunctionPrototype","refuseSerialization","createMagicGlobalFunction","functionName","args","types","values","$Realm","generator","derive","_args","identifier","createMagicGlobalObject","objectName","globalObject","createAbstractObject","kind","false"],"mappings":"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","file":"fb-mocks.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Realm } from \"../../realm.js\";\nimport { TypesDomain, ValuesDomain } from \"../../domains/index.js\";\nimport {\n  ArrayValue,\n  AbstractValue,\n  FunctionValue,\n  AbstractObjectValue,\n  NativeFunctionValue,\n  ObjectValue,\n  StringValue,\n  NumberValue,\n} from \"../../values/index.js\";\nimport { Create } from \"../../singletons.js\";\nimport { Get } from \"../../methods/index.js\";\nimport * as t from \"babel-types\";\nimport invariant from \"../../invariant\";\nimport { Properties } from \"../../singletons.js\";\nimport { forEachArrayValue } from \"../../react/utils.js\";\n\nconst fbMagicGlobalFunctions = [\n  \"asset\",\n  \"cx\",\n  \"cssVar\",\n  \"csx\",\n  \"errorDesc\",\n  \"errorHelpCenterID\",\n  \"errorSummary\",\n  \"gkx\",\n  \"glyph\",\n  \"ifRequired\",\n  \"ix\",\n  \"fbglyph\",\n  \"requireWeak\",\n  \"xuiglyph\",\n];\n\nconst fbMagicGlobalObjects = [\"JSResource\", \"Bootloader\"];\n\nfunction createBabelHelpers(realm: Realm, global: ObjectValue | AbstractObjectValue) {\n  let babelHelpersValue = new ObjectValue(realm, realm.intrinsics.ObjectPrototype, `babelHelpers`, true);\n  let objectAssign = Get(realm, realm.intrinsics.Object, \"assign\");\n  let objectCreate = Get(realm, realm.intrinsics.Object, \"create\");\n\n  //babelHelpers.objectWithoutProperties\n  let inheritsValue = new NativeFunctionValue(realm, undefined, `inherits`, 2, (context, [subClass, superClass]) => {\n    invariant(objectAssign instanceof NativeFunctionValue);\n    let objectAssignCall = objectAssign.$Call;\n    invariant(objectAssignCall !== undefined);\n    objectAssignCall(realm.intrinsics.undefined, [subClass, superClass]);\n\n    invariant(superClass instanceof ObjectValue);\n    let superClassPrototype = Get(realm, superClass, \"prototype\");\n    invariant(objectCreate instanceof NativeFunctionValue);\n    let objectCreateCall = objectCreate.$Call;\n    invariant(typeof objectCreateCall === \"function\");\n    let newPrototype = objectCreateCall(realm.intrinsics.undefined, [superClassPrototype]);\n\n    invariant(subClass instanceof ObjectValue);\n    invariant(newPrototype instanceof ObjectValue);\n    Properties.Set(realm, subClass, \"prototype\", newPrototype, true);\n    Properties.Set(realm, newPrototype, \"constructor\", subClass, true);\n    Properties.Set(realm, subClass, \"__superConstructor__\", superClass, true);\n\n    return superClass;\n  });\n  babelHelpersValue.$DefineOwnProperty(\"inherits\", {\n    value: inheritsValue,\n    writable: false,\n    enumerable: false,\n    configurable: true,\n  });\n  inheritsValue.intrinsicName = `babelHelpers.inherits`;\n\n  //babelHelpers.objectWithoutProperties\n  let objectWithoutPropertiesValue = new NativeFunctionValue(\n    realm,\n    undefined,\n    `objectWithoutProperties`,\n    2,\n    (context, [obj, keys]) => {\n      invariant(obj instanceof ObjectValue || obj instanceof AbstractObjectValue);\n      invariant(keys instanceof ArrayValue);\n      if (obj.isPartialObject() || obj instanceof AbstractObjectValue) {\n        let value = AbstractValue.createTemporalFromBuildFunction(\n          realm,\n          ObjectValue,\n          [objectWithoutPropertiesValue, obj, keys],\n          ([methodNode, objNode, propRemoveNode]) => {\n            return t.callExpression(methodNode, [objNode, propRemoveNode]);\n          }\n        );\n        if (value instanceof AbstractObjectValue) {\n          // as we are returning an abstract object, we mark it as simple\n          value.makeSimple();\n        }\n        return value;\n      } else {\n        let removeKeys = new Set();\n        forEachArrayValue(realm, keys, key => {\n          if (key instanceof StringValue || key instanceof NumberValue) {\n            removeKeys.add(key.value);\n          }\n        });\n        let newObject = Create.ObjectCreate(realm, realm.intrinsics.ObjectPrototype);\n        for (let [propName, binding] of obj.properties) {\n          if (!removeKeys.has(propName)) {\n            if (binding && binding.descriptor && binding.descriptor.enumerable) {\n              let value = Get(realm, obj, propName);\n              Properties.Set(realm, newObject, propName, value, true);\n            }\n          }\n        }\n        return newObject;\n      }\n    }\n  );\n  babelHelpersValue.$DefineOwnProperty(\"objectWithoutProperties\", {\n    value: objectWithoutPropertiesValue,\n    writable: false,\n    enumerable: false,\n    configurable: true,\n  });\n  objectWithoutPropertiesValue.intrinsicName = `babelHelpers.objectWithoutProperties`;\n\n  //babelHelpers.taggedTemplateLiteralLoose\n  let taggedTemplateLiteralLooseValue = new NativeFunctionValue(\n    realm,\n    undefined,\n    `taggedTemplateLiteralLoose`,\n    2,\n    (context, [strings, raw]) => {\n      invariant(strings instanceof ObjectValue);\n      Properties.Set(realm, strings, \"raw\", raw, true);\n      return strings;\n    }\n  );\n  babelHelpersValue.$DefineOwnProperty(\"taggedTemplateLiteralLoose\", {\n    value: taggedTemplateLiteralLooseValue,\n    writable: false,\n    enumerable: false,\n    configurable: true,\n  });\n  taggedTemplateLiteralLooseValue.intrinsicName = `babelHelpers.taggedTemplateLiteralLoose`;\n\n  //babelHelpers.extends & babelHelpers._extends\n  babelHelpersValue.$DefineOwnProperty(\"extends\", {\n    value: objectAssign,\n    writable: true,\n    enumerable: true,\n    configurable: true,\n  });\n\n  babelHelpersValue.$DefineOwnProperty(\"_extends\", {\n    value: objectAssign,\n    writable: true,\n    enumerable: true,\n    configurable: true,\n  });\n\n  //babelHelpers.bind\n  let functionBind = Get(realm, realm.intrinsics.FunctionPrototype, \"bind\");\n\n  babelHelpersValue.$DefineOwnProperty(\"bind\", {\n    value: functionBind,\n    writable: true,\n    enumerable: true,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"babelHelpers\", {\n    value: babelHelpersValue,\n    writable: true,\n    enumerable: true,\n    configurable: true,\n  });\n  babelHelpersValue.refuseSerialization = false;\n}\n\nfunction createMagicGlobalFunction(realm: Realm, global: ObjectValue | AbstractObjectValue, functionName: string) {\n  global.$DefineOwnProperty(functionName, {\n    value: new NativeFunctionValue(realm, functionName, functionName, 0, (context, args) => {\n      let types = new TypesDomain(FunctionValue);\n      let values = new ValuesDomain();\n      invariant(context.$Realm.generator);\n      return context.$Realm.generator.derive(types, values, args, _args =>\n        t.callExpression(t.identifier(functionName), ((_args: any): Array<any>))\n      );\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n}\n\nfunction createMagicGlobalObject(realm: Realm, global: ObjectValue | AbstractObjectValue, objectName: string) {\n  let globalObject = AbstractValue.createAbstractObject(realm, objectName);\n  globalObject.kind = \"resolved\";\n\n  global.$DefineOwnProperty(objectName, {\n    value: globalObject,\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n}\n\nexport function createFbMocks(realm: Realm, global: ObjectValue | AbstractObjectValue) {\n  global.$DefineOwnProperty(\"__DEV__\", {\n    // TODO: we'll likely want to make this configurable from the outside.\n    value: realm.intrinsics.false,\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  createBabelHelpers(realm, global);\n\n  for (let functionName of fbMagicGlobalFunctions) {\n    createMagicGlobalFunction(realm, global, functionName);\n  }\n\n  for (let objectName of fbMagicGlobalObjects) {\n    createMagicGlobalObject(realm, global, objectName);\n  }\n}\n"]}