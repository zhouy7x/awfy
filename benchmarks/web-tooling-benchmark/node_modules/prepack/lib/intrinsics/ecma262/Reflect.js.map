{"version":3,"sources":["../../../src/intrinsics/ecma262/Reflect.js"],"names":["realm","obj","intrinsics","ObjectPrototype","defineNativeMethod","context","target","thisArgument","argumentsList","createErrorThrowCompletion","TypeError","args","CreateListFromArrayLike","newTarget","propertyKey","attributes","throwIfNotConcrete","key","ToPropertyKey","desc","ToPropertyDescriptor","$DefineOwnProperty","$Delete","receiver","$Get","$GetOwnProperty","FromPropertyDescriptor","$GetPrototypeOf","mightNotBeObject","mightBeObject","$HasProperty","$IsExtensible","keys","$OwnPropertyKeys","CreateArrayFromList","$PreventExtensions","V","$Set","proto","$SetPrototypeOf"],"mappings":"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","file":"Reflect.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Realm } from \"../../realm.js\";\nimport { BooleanValue, ObjectValue, NullValue } from \"../../values/index.js\";\nimport { Call, Construct, IsCallable, IsConstructor } from \"../../methods/index.js\";\nimport { Create, Properties, To } from \"../../singletons.js\";\n\nexport default function(realm: Realm): ObjectValue {\n  let obj = new ObjectValue(realm, realm.intrinsics.ObjectPrototype, \"Reflect\");\n\n  // ECMA262 26.1.1\n  obj.defineNativeMethod(\"apply\", 3, (context, [target, thisArgument, argumentsList]) => {\n    // 1. If IsCallable(target) is false, throw a TypeError exception.\n    if (!IsCallable(realm, target)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Let args be ? CreateListFromArrayLike(argumentsList).\n    let args = Create.CreateListFromArrayLike(realm, argumentsList);\n\n    // TODO #1008 3. Perform PrepareForTailCall().\n\n    // 4. Return ? Call(target, thisArgument, args).\n    return Call(realm, target, thisArgument, args);\n  });\n\n  // ECMA262 26.1.2\n  obj.defineNativeMethod(\"construct\", 2, (context, [target, argumentsList, newTarget]) => {\n    // 1. If IsConstructor(target) is false, throw a TypeError exception.\n    if (!IsConstructor(realm, target)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. If newTarget is not present, let newTarget be target.\n    if (!newTarget) {\n      newTarget = target;\n    } else if (!IsConstructor(realm, newTarget)) {\n      // 3. Else if IsConstructor(newTarget) is false, throw a TypeError exception.\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 4. Let args be ? CreateListFromArrayLike(argumentsList).\n    let args = Create.CreateListFromArrayLike(realm, argumentsList);\n\n    // 5. Return ? Construct(target, args, newTarget).\n    return Construct(realm, target, args, newTarget);\n  });\n\n  // ECMA262 26.1.3\n  obj.defineNativeMethod(\"defineProperty\", 3, (context, [target, propertyKey, attributes]) => {\n    target = target.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Let key be ? ToPropertyKey(propertyKey).\n    let key = To.ToPropertyKey(realm, propertyKey);\n\n    // 3. Let desc be ? ToPropertyDescriptor(attributes).\n    let desc = To.ToPropertyDescriptor(realm, attributes);\n\n    // 4. Return ? target.[[DefineOwnProperty]](key, desc).\n    return new BooleanValue(realm, target.$DefineOwnProperty(key, desc));\n  });\n\n  // ECMA262 26.1.4\n  obj.defineNativeMethod(\"deleteProperty\", 2, (context, [target, propertyKey]) => {\n    target = target.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Let key be ? ToPropertyKey(propertyKey).\n    let key = To.ToPropertyKey(realm, propertyKey);\n\n    // 3. Return ? target.[[Delete]](key).\n    return new BooleanValue(realm, target.$Delete(key));\n  });\n\n  // ECMA262 26.1.5\n  obj.defineNativeMethod(\"get\", 2, (context, [target, propertyKey, receiver]) => {\n    target = target.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Let key be ? ToPropertyKey(propertyKey).\n    let key = To.ToPropertyKey(realm, propertyKey);\n\n    // 3. If receiver is not present, then\n    if (!receiver) {\n      // a. Let receiver be target.\n      receiver = target;\n    }\n\n    // 4. Return ? target.[[Get]](key, receiver).\n    return target.$Get(key, receiver);\n  });\n\n  // ECMA262 26.1.6\n  obj.defineNativeMethod(\"getOwnPropertyDescriptor\", 2, (context, [target, propertyKey]) => {\n    target = target.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Let key be ? ToPropertyKey(propertyKey).\n    let key = To.ToPropertyKey(realm, propertyKey);\n\n    // 3. Let desc be ? target.[[GetOwnProperty]](key).\n    let desc = target.$GetOwnProperty(key);\n\n    // 4. Return FromPropertyDescriptor(desc).\n    return Properties.FromPropertyDescriptor(realm, desc);\n  });\n\n  // ECMA262 26.1.7\n  obj.defineNativeMethod(\"getPrototypeOf\", 1, (context, [target]) => {\n    target = target.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Return ? target.[[GetPrototypeOf]]().\n    return target.$GetPrototypeOf();\n  });\n\n  // ECMA262 26.1.8\n  obj.defineNativeMethod(\"has\", 2, (context, [target, propertyKey]) => {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (target.mightNotBeObject()) {\n      if (target.mightBeObject()) target.throwIfNotConcrete();\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Let key be ? ToPropertyKey(propertyKey).\n    let key = To.ToPropertyKey(realm, propertyKey);\n\n    // 3. Return ? target.[[HasProperty]](key).\n    return new BooleanValue(realm, target.$HasProperty(key));\n  });\n\n  // ECMA262 26.1.9\n  obj.defineNativeMethod(\"isExtensible\", 1, (context, [target]) => {\n    target = target.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Return ? target.[[IsExtensible]]().\n    return new BooleanValue(realm, target.$IsExtensible());\n  });\n\n  // ECMA262 26.1.10\n  obj.defineNativeMethod(\"ownKeys\", 1, (context, [target]) => {\n    target = target.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Let keys be ? target.[[OwnPropertyKeys]]().\n    let keys = target.$OwnPropertyKeys();\n\n    // 3. Return CreateArrayFromList(keys).\n    return Create.CreateArrayFromList(realm, keys);\n  });\n\n  // ECMA262 26.1.11\n  obj.defineNativeMethod(\"preventExtensions\", 1, (context, [target]) => {\n    target = target.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Return ? target.[[PreventExtensions]]().\n    return new BooleanValue(realm, target.$PreventExtensions());\n  });\n\n  // ECMA262 26.1.12\n  obj.defineNativeMethod(\"set\", 3, (context, [target, propertyKey, V, receiver]) => {\n    target = target.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Let key be ? ToPropertyKey(propertyKey).\n    let key = To.ToPropertyKey(realm, propertyKey);\n\n    // 3. If receiver is not present, then\n    if (!receiver) {\n      // a. Let receiver be target.\n      receiver = target;\n    }\n\n    // 5. Return ? target.[[Set]](key, V, receiver).\n    return new BooleanValue(realm, target.$Set(key, V, receiver));\n  });\n\n  // ECMA262 26.1.13\n  obj.defineNativeMethod(\"setPrototypeOf\", 2, (context, [target, proto]) => {\n    target = target.throwIfNotConcrete();\n    proto = proto.throwIfNotConcrete();\n\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!(target instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. If Type(proto) is not Object and proto is not null, throw a TypeError exception.\n    if (!(proto instanceof ObjectValue) && !(proto instanceof NullValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 3. Return ? target.[[SetPrototypeOf]](proto).\n    return new BooleanValue(realm, target.$SetPrototypeOf(proto));\n  });\n\n  return obj;\n}\n"]}