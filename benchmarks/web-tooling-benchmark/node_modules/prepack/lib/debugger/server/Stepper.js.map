{"version":3,"sources":["../../../src/debugger/server/Stepper.js"],"names":["Stepper","constructor","filePath","line","column","_stepStartData","isComplete","ast","currentStackSize","isAstLocationChanged","loc","source","start","StepIntoStepper","StepOverStepper","stackSize","_startStackSize"],"mappings":";;;;;;;AAWA;;AACA;;AACA;;;;;;AAbA;;;;;;;;;AAeO,MAAMA,OAAN,CAAc;AACnBC,cAAYC,QAAZ,EAA8BC,IAA9B,EAA4CC,MAA5C,EAA4D;AAC1D,SAAKC,cAAL,GAAsB;AACpBH,gBAAUA,QADU;AAEpBC,YAAMA,IAFc;AAGpBC,cAAQA;AAHY,KAAtB;AAKD;;;AAGDE,aAAWC,GAAX,EAA2BC,gBAA3B,EAA8D;AAC5D,6BAAU,KAAV,EAAiB,kCAAjB;AACD;;AAEDC,uBAAqBF,GAArB,EAAqC;AACnC;AACA,QAAI,CAAC,qBAAYA,GAAZ,CAAL,EAAuB,OAAO,KAAP;AACvB,QAAIG,MAAMH,IAAIG,GAAd;AACA,QAAI,CAACA,GAAL,EAAU,OAAO,KAAP;AACV,QAAIR,WAAWQ,IAAIC,MAAnB;AACA,QAAIR,OAAOO,IAAIE,KAAJ,CAAUT,IAArB;AACA,QAAIC,SAASM,IAAIE,KAAJ,CAAUR,MAAvB;AACA,QAAI,CAACF,QAAL,EAAe,OAAO,KAAP;AACf,QAAI,KAAKG,cAAT,EAAyB;AACvB,UACEH,aAAa,KAAKG,cAAL,CAAoBH,QAAjC,IACAC,SAAS,KAAKE,cAAL,CAAoBF,IAD7B,IAEAC,WAAW,KAAKC,cAAL,CAAoBD,MAHjC,EAIE;AACA,eAAO,KAAP;AACD;AACF,KARD,MAQO;AACL,aAAO,KAAP;AACD;AACD,WAAO,IAAP;AACD;AAnCkB;;QAARJ,O,GAAAA,O;AAsCN,MAAMa,eAAN,SAA8Bb,OAA9B,CAAsC;AAC3CC,cAAYC,QAAZ,EAA8BC,IAA9B,EAA4CC,MAA5C,EAA4D;AAC1D,UAAMF,QAAN,EAAgBC,IAAhB,EAAsBC,MAAtB;AACD;;AAED;AACAE,aAAWC,GAAX,EAA2BC,gBAA3B,EAA8D;AAC5D,WAAO,KAAKC,oBAAL,CAA0BF,GAA1B,CAAP;AACD;AAR0C;;QAAhCM,e,GAAAA,e;AAWN,MAAMC,eAAN,SAA8Bd,OAA9B,CAAsC;AAC3CC,cAAYC,QAAZ,EAA8BC,IAA9B,EAA4CC,MAA5C,EAA4DW,SAA5D,EAA+E;AAC7E,UAAMb,QAAN,EAAgBC,IAAhB,EAAsBC,MAAtB;AACA,SAAKY,eAAL,GAAuBD,SAAvB;AACD;;;AAGDT,aAAWC,GAAX,EAA2BC,gBAA3B,EAA8D;AAC5D,QAAI,CAAC,KAAKC,oBAAL,CAA0BF,GAA1B,CAAL,EAAqC,OAAO,KAAP;AACrC,QAAIC,oBAAoB,KAAKQ,eAA7B,EAA8C;AAC5C;AACA;AACA;AACA;AACA;AACA,aAAO,IAAP;AACD;AACD,WAAO,KAAP;AACD;AAlB0C;QAAhCF,e,GAAAA,e","file":"Stepper.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\nimport type { SourceData } from \"./../common/types.js\";\nimport { IsStatement } from \"./../../methods/is.js\";\nimport { BabelNode } from \"babel-types\";\nimport invariant from \"./../common/invariant.js\";\n\nexport class Stepper {\n  constructor(filePath: string, line: number, column: number) {\n    this._stepStartData = {\n      filePath: filePath,\n      line: line,\n      column: column,\n    };\n  }\n  _stepStartData: SourceData;\n\n  isComplete(ast: BabelNode, currentStackSize: number): boolean {\n    invariant(false, \"Abstract method, please override\");\n  }\n\n  isAstLocationChanged(ast: BabelNode) {\n    // we should only step to statements\n    if (!IsStatement(ast)) return false;\n    let loc = ast.loc;\n    if (!loc) return false;\n    let filePath = loc.source;\n    let line = loc.start.line;\n    let column = loc.start.column;\n    if (!filePath) return false;\n    if (this._stepStartData) {\n      if (\n        filePath === this._stepStartData.filePath &&\n        line === this._stepStartData.line &&\n        column === this._stepStartData.column\n      ) {\n        return false;\n      }\n    } else {\n      return false;\n    }\n    return true;\n  }\n}\n\nexport class StepIntoStepper extends Stepper {\n  constructor(filePath: string, line: number, column: number) {\n    super(filePath, line, column);\n  }\n\n  // Override\n  isComplete(ast: BabelNode, currentStackSize: number): boolean {\n    return this.isAstLocationChanged(ast);\n  }\n}\n\nexport class StepOverStepper extends Stepper {\n  constructor(filePath: string, line: number, column: number, stackSize: number) {\n    super(filePath, line, column);\n    this._startStackSize = stackSize;\n  }\n  _startStackSize: number;\n\n  isComplete(ast: BabelNode, currentStackSize: number): boolean {\n    if (!this.isAstLocationChanged(ast)) return false;\n    if (currentStackSize <= this._startStackSize) {\n      // two cases here:\n      // if current stack length < starting stack length, the program must have\n      // hit an exception so this stepper is no longer relevant\n      // if current stack length === starting stack length, the program returned\n      // to the same stack depth, so a step over is complete\n      return true;\n    }\n    return false;\n  }\n}\n"]}