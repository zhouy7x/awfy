{"version":3,"sources":["../src/completions.js"],"names":["Completion","constructor","value","location","target","NormalCompletion","AbruptCompletion","ThrowCompletion","nativeStack","Error","stack","ContinueCompletion","BreakCompletion","ReturnCompletion","JoinedAbruptCompletions","realm","joinCondition","consequent","consequentEffects","alternate","alternateEffects","intrinsics","empty","containsBreakOrContinue","PossiblyNormalCompletion","pathConditions","savedPathConditions","savedEffects","undefined","loc","expressionLocation"],"mappings":";;;;;;;AAYA;;;;AAEA;;;;AAEO,MAAMA,UAAN,CAAiB;AACtBC,cAAYC,KAAZ,EAA0BC,QAA1B,EAA8DC,MAA9D,EAAgF;AAC9E,SAAKF,KAAL,GAAaA,KAAb;AACA,SAAKE,MAAL,GAAcA,MAAd;AACA,SAAKD,QAAL,GAAgBA,QAAhB;AACD;;AALqB;;QAAXH,U,GAAAA,U,EAYb;AA5BA;;;;;;;;;AA6BO,MAAMK,gBAAN,SAA+BL,UAA/B,CAA0C;;QAApCK,gB,GAAAA,gB,EAEb;AACA;;AACO,MAAMC,gBAAN,SAA+BN,UAA/B,CAA0C;;QAApCM,gB,GAAAA,gB;AAEN,MAAMC,eAAN,SAA8BD,gBAA9B,CAA+C;AACpDL,cAAYC,KAAZ,EAA0BC,QAA1B,EAA8DK,WAA9D,EAAqF;AACnF,UAAMN,KAAN,EAAaC,QAAb;AACA,SAAKK,WAAL,GAAmBA,eAAe,IAAIC,KAAJ,GAAYC,KAA9C;AACD;;AAJmD;QAAzCH,e,GAAAA,e;AAQN,MAAMI,kBAAN,SAAiCL,gBAAjC,CAAkD;AACvDL,cAAYC,KAAZ,EAA0BC,QAA1B,EAA8DC,MAA9D,EAA+E;AAC7E,UAAMF,KAAN,EAAaC,QAAb,EAAuBC,MAAvB;AACD;AAHsD;;QAA5CO,kB,GAAAA,kB;AAMN,MAAMC,eAAN,SAA8BN,gBAA9B,CAA+C;AACpDL,cAAYC,KAAZ,EAA0BC,QAA1B,EAA8DC,MAA9D,EAA+E;AAC7E,UAAMF,KAAN,EAAaC,QAAb,EAAuBC,MAAvB;AACD;AAHmD;;QAAzCQ,e,GAAAA,e;AAMN,MAAMC,gBAAN,SAA+BP,gBAA/B,CAAgD;AACrDL,cAAYC,KAAZ,EAA0BC,QAA1B,EAA8D;AAC5D,UAAMD,KAAN,EAAaC,QAAb;AACD;AAHoD;;QAA1CU,gB,GAAAA,gB;AAMN,MAAMC,uBAAN,SAAsCR,gBAAtC,CAAuD;AAC5DL,cACEc,KADF,EAEEC,aAFF,EAGEC,UAHF,EAIEC,iBAJF,EAKEC,SALF,EAMEC,gBANF,EAOE;AACA,UAAML,MAAMM,UAAN,CAAiBC,KAAvB,EAA8BL,WAAWd,QAAzC;AACA,SAAKa,aAAL,GAAqBA,aAArB;AACA,SAAKC,UAAL,GAAkBA,UAAlB;AACA,SAAKC,iBAAL,GAAyBA,iBAAzB;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,gBAAL,GAAwBA,gBAAxB;AACD;;AAQDG,4BAAmC;AACjC,QAAI,KAAKN,UAAL,YAA2BL,eAA3B,IAA8C,KAAKK,UAAL,YAA2BN,kBAA7E,EAAiG,OAAO,IAAP;AACjG,QAAI,KAAKQ,SAAL,YAA0BP,eAA1B,IAA6C,KAAKO,SAAL,YAA0BR,kBAA3E,EAA+F,OAAO,IAAP;AAC/F,QAAI,KAAKM,UAAL,YAA2BH,uBAA/B,EAAwD;AACtD,UAAI,KAAKG,UAAL,CAAgBM,uBAAhB,EAAJ,EAA+C,OAAO,IAAP;AAChD;AACD,QAAI,KAAKJ,SAAL,YAA0BL,uBAA9B,EAAuD;AACrD,UAAI,KAAKK,SAAL,CAAeI,uBAAf,EAAJ,EAA8C,OAAO,IAAP;AAC/C;AACD,WAAO,KAAP;AACD;AAjC2D;;QAAjDT,uB,GAAAA,uB,EAoCb;AACA;AACA;;AACO,MAAMU,wBAAN,SAAuCnB,gBAAvC,CAAwD;AAC7DJ,cACEC,KADF,EAEEc,aAFF,EAGEC,UAHF,EAIEC,iBAJF,EAKEC,SALF,EAMEC,gBANF,EAOEK,cAPF,EAQEC,mBARF,EASEC,eAA+BC,SATjC,EAUE;AACA,6BAAUX,eAAeC,kBAAkB,CAAlB,CAAzB;AACA,6BAAUC,cAAcC,iBAAiB,CAAjB,CAAxB;AACA,6BACEH,sBAAsBZ,gBAAtB,IACEY,kCADF,IAEEE,qBAAqBd,gBAFvB,IAGEc,iCAJJ;AAMA,6BAAUF,sBAAsBX,gBAAtB,IAA0Ca,qBAAqBb,gBAAzE;AACA,6BACEJ,UAAUe,UAAV,IACEA,sBAAsBX,gBADxB,IAEGW,sBAAsBZ,gBAAtB,IAA0CH,UAAUe,WAAWf,KAHpE;AAKA,6BACEA,UAAUiB,SAAV,IACEA,qBAAqBb,gBADvB,IAEGa,qBAAqBd,gBAArB,IAAyCH,UAAUiB,UAAUjB,KAHlE;AAKA,QAAI2B,MACFZ,sBAAsBX,gBAAtB,GACIW,WAAWd,QADf,GAEIgB,qBAAqBnB,UAArB,GAAkCmB,UAAUhB,QAA5C,GAAuDgB,UAAUW,kBAHvE;AAIA,UAAM5B,KAAN,EAAa2B,GAAb;AACA,SAAKb,aAAL,GAAqBA,aAArB;AACA,SAAKC,UAAL,GAAkBA,UAAlB;AACA,SAAKC,iBAAL,GAAyBA,iBAAzB;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,gBAAL,GAAwBA,gBAAxB;AACA,SAAKO,YAAL,GAAoBA,YAApB;AACA,SAAKF,cAAL,GAAsBA,cAAtB;AACA,SAAKC,mBAAL,GAA2BA,mBAA3B;AACD;;AAWDH,4BAAmC;AACjC,QAAI,KAAKN,UAAL,YAA2BL,eAA3B,IAA8C,KAAKK,UAAL,YAA2BN,kBAA7E,EAAiG,OAAO,IAAP;AACjG,QAAI,KAAKQ,SAAL,YAA0BP,eAA1B,IAA6C,KAAKO,SAAL,YAA0BR,kBAA3E,EAA+F,OAAO,IAAP;AAC/F,QAAI,KAAKM,UAAL,YAA2BH,uBAA3B,IAAsD,KAAKG,UAAL,YAA2BO,wBAArF,EAA+G;AAC7G,UAAI,KAAKP,UAAL,CAAgBM,uBAAhB,EAAJ,EAA+C,OAAO,IAAP;AAChD;AACD,QAAI,KAAKJ,SAAL,YAA0BL,uBAA1B,IAAqD,KAAKK,SAAL,YAA0BK,wBAAnF,EAA6G;AAC3G,UAAI,KAAKL,SAAL,CAAeI,uBAAf,EAAJ,EAA8C,OAAO,IAAP;AAC/C;AACD,WAAO,KAAP;AACD;AAjE4D;QAAlDC,wB,GAAAA,wB","file":"completions.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { BabelNodeSourceLocation } from \"babel-types\";\nimport invariant from \"./invariant.js\";\nimport type { Effects, Realm } from \"./realm.js\";\nimport { AbstractValue, Value } from \"./values/index.js\";\n\nexport class Completion {\n  constructor(value: Value, location: ?BabelNodeSourceLocation, target?: ?string) {\n    this.value = value;\n    this.target = target;\n    this.location = location;\n  }\n\n  value: Value;\n  target: ?string;\n  location: ?BabelNodeSourceLocation;\n}\n\n// Normal completions are returned just like spec completions\nexport class NormalCompletion extends Completion {}\n\n// Abrupt completions are thrown as exeptions, to make it a easier\n// to quickly get to the matching high level construct.\nexport class AbruptCompletion extends Completion {}\n\nexport class ThrowCompletion extends AbruptCompletion {\n  constructor(value: Value, location: ?BabelNodeSourceLocation, nativeStack?: ?string) {\n    super(value, location);\n    this.nativeStack = nativeStack || new Error().stack;\n  }\n\n  nativeStack: string;\n}\nexport class ContinueCompletion extends AbruptCompletion {\n  constructor(value: Value, location: ?BabelNodeSourceLocation, target: ?string) {\n    super(value, location, target);\n  }\n}\n\nexport class BreakCompletion extends AbruptCompletion {\n  constructor(value: Value, location: ?BabelNodeSourceLocation, target: ?string) {\n    super(value, location, target);\n  }\n}\n\nexport class ReturnCompletion extends AbruptCompletion {\n  constructor(value: Value, location: ?BabelNodeSourceLocation) {\n    super(value, location);\n  }\n}\n\nexport class JoinedAbruptCompletions extends AbruptCompletion {\n  constructor(\n    realm: Realm,\n    joinCondition: AbstractValue,\n    consequent: AbruptCompletion,\n    consequentEffects: Effects,\n    alternate: AbruptCompletion,\n    alternateEffects: Effects\n  ) {\n    super(realm.intrinsics.empty, consequent.location);\n    this.joinCondition = joinCondition;\n    this.consequent = consequent;\n    this.consequentEffects = consequentEffects;\n    this.alternate = alternate;\n    this.alternateEffects = alternateEffects;\n  }\n\n  joinCondition: AbstractValue;\n  consequent: AbruptCompletion;\n  consequentEffects: Effects;\n  alternate: AbruptCompletion;\n  alternateEffects: Effects;\n\n  containsBreakOrContinue(): boolean {\n    if (this.consequent instanceof BreakCompletion || this.consequent instanceof ContinueCompletion) return true;\n    if (this.alternate instanceof BreakCompletion || this.alternate instanceof ContinueCompletion) return true;\n    if (this.consequent instanceof JoinedAbruptCompletions) {\n      if (this.consequent.containsBreakOrContinue()) return true;\n    }\n    if (this.alternate instanceof JoinedAbruptCompletions) {\n      if (this.alternate.containsBreakOrContinue()) return true;\n    }\n    return false;\n  }\n}\n\n// Possibly normal completions have to be treated like normal completions\n// and are thus never thrown. At the end of a try block or loop body, however,\n// action must be taken to deal with the possibly abrupt case of the completion.\nexport class PossiblyNormalCompletion extends NormalCompletion {\n  constructor(\n    value: Value,\n    joinCondition: AbstractValue,\n    consequent: Completion | Value,\n    consequentEffects: Effects,\n    alternate: Completion | Value,\n    alternateEffects: Effects,\n    pathConditions: Array<AbstractValue>,\n    savedPathConditions: Array<AbstractValue>,\n    savedEffects: void | Effects = undefined\n  ) {\n    invariant(consequent === consequentEffects[0]);\n    invariant(alternate === alternateEffects[0]);\n    invariant(\n      consequent instanceof NormalCompletion ||\n        consequent instanceof Value ||\n        alternate instanceof NormalCompletion ||\n        alternate instanceof Value\n    );\n    invariant(consequent instanceof AbruptCompletion || alternate instanceof AbruptCompletion);\n    invariant(\n      value === consequent ||\n        consequent instanceof AbruptCompletion ||\n        (consequent instanceof NormalCompletion && value === consequent.value)\n    );\n    invariant(\n      value === alternate ||\n        alternate instanceof AbruptCompletion ||\n        (alternate instanceof NormalCompletion && value === alternate.value)\n    );\n    let loc =\n      consequent instanceof AbruptCompletion\n        ? consequent.location\n        : alternate instanceof Completion ? alternate.location : alternate.expressionLocation;\n    super(value, loc);\n    this.joinCondition = joinCondition;\n    this.consequent = consequent;\n    this.consequentEffects = consequentEffects;\n    this.alternate = alternate;\n    this.alternateEffects = alternateEffects;\n    this.savedEffects = savedEffects;\n    this.pathConditions = pathConditions;\n    this.savedPathConditions = savedPathConditions;\n  }\n\n  joinCondition: AbstractValue;\n  consequent: Completion | Value;\n  consequentEffects: Effects;\n  alternate: Completion | Value;\n  alternateEffects: Effects;\n  savedEffects: void | Effects;\n  pathConditions: Array<AbstractValue>;\n  savedPathConditions: Array<AbstractValue>;\n\n  containsBreakOrContinue(): boolean {\n    if (this.consequent instanceof BreakCompletion || this.consequent instanceof ContinueCompletion) return true;\n    if (this.alternate instanceof BreakCompletion || this.alternate instanceof ContinueCompletion) return true;\n    if (this.consequent instanceof JoinedAbruptCompletions || this.consequent instanceof PossiblyNormalCompletion) {\n      if (this.consequent.containsBreakOrContinue()) return true;\n    }\n    if (this.alternate instanceof JoinedAbruptCompletions || this.alternate instanceof PossiblyNormalCompletion) {\n      if (this.alternate.containsBreakOrContinue()) return true;\n    }\n    return false;\n  }\n}\n"]}